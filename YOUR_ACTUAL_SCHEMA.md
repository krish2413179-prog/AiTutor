# Your Actual Database Schema

## ‚úÖ Tables You Have

### `public.profiles`
```sql
CREATE TABLE public.profiles (
  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,
  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT timezone('utc'::text, now()),
  wallet_address TEXT NOT NULL UNIQUE,
  nft_mint_address TEXT NULL,
  current_memory_hash TEXT NULL,
  traits JSONB NULL DEFAULT '{}'::jsonb,
  last_anchored_at TIMESTAMP WITH TIME ZONE NULL,
  level TEXT NULL DEFAULT '1'::text,
  topics_mastered TEXT[] NULL DEFAULT '{}'::text[],
  xp NUMERIC NULL DEFAULT 0
);
```

### `public.chats`
```sql
CREATE TABLE public.chats (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now()) NOT NULL,
  wallet_address TEXT REFERENCES public.profiles(wallet_address) ON DELETE CASCADE NOT NULL,
  role TEXT NOT NULL CHECK (role IN ('user', 'assistant', 'system')),
  content TEXT NOT NULL,
  tokens INT DEFAULT 0
);
```

## ‚úÖ Code Updated to Match

I've updated the code to work with your exact schema:

### What Changed:
- ‚ùå Removed `system_prompt` (doesn't exist in your schema)
- ‚úÖ Using `level` as TEXT (your schema: '1', '2', '3')
- ‚úÖ Using `xp` as NUMERIC (for experience points)
- ‚úÖ Using `traits` as JSONB (for custom attributes)
- ‚úÖ Using `current_memory_hash` (for blockchain anchoring)
- ‚úÖ Using `last_anchored_at` (timestamp of last on-chain update)
- ‚úÖ Using `nft_mint_address` (for NFT reference)

## üéØ How It Works Now

### When You Click "MINT YOUR AI SOUL":
```javascript
{
  wallet_address: "27sh189H11aUeKzsj9S7G99cSJF1ZPngPiTNJ5NCnqA3",
  level: "1",
  topics_mastered: [],
  xp: 0,
  traits: {}
}
```

### When You Send a Chat Message:
```javascript
{
  wallet_address: "27sh189H11aUeKzsj9S7G99cSJF1ZPngPiTNJ5NCnqA3",
  role: "user",
  content: "Hello!",
  tokens: 0
}
```

### When AI Responds:
```javascript
{
  wallet_address: "27sh189H11aUeKzsj9S7G99cSJF1ZPngPiTNJ5NCnqA3",
  role: "assistant",
  content: "Hi! How can I help you?",
  tokens: 45  // OpenAI token count
}
```

## üöÄ New Features Available

### Update XP (Experience Points)
```javascript
await updateUserXP(walletAddress, 10); // Add 10 XP
```

### Update Memory Hash (Blockchain Anchor)
```javascript
await updateMemoryHash(walletAddress, "a1b2c3d4...");
```

## üìä Your Profile Fields Explained

| Field | Type | Purpose |
|-------|------|---------|
| `wallet_address` | TEXT | User's Solana wallet (unique ID) |
| `level` | TEXT | Learning level ('1', '2', '3', etc.) |
| `xp` | NUMERIC | Experience points earned |
| `topics_mastered` | TEXT[] | Array of learned topics |
| `traits` | JSONB | Custom attributes (flexible) |
| `current_memory_hash` | TEXT | SHA-256 hash for blockchain |
| `last_anchored_at` | TIMESTAMP | Last on-chain update time |
| `nft_mint_address` | TEXT | Associated NFT address |

## üéÆ Level System

Your schema uses TEXT for levels. You can implement:
- Level 1: Beginner
- Level 2: Intermediate  
- Level 3: Advanced
- Level 4: Expert
- Level 5: Master

Or use numeric strings: '1', '2', '3', etc.

## üíé Traits System

The `traits` JSONB field is flexible. You can store:
```json
{
  "learning_style": "visual",
  "preferred_topics": ["blockchain", "AI"],
  "streak_days": 7,
  "badges": ["first_chat", "week_streak"]
}
```

## üîó NFT Integration

Use `nft_mint_address` to link the profile to an actual Solana NFT:
```javascript
await supabase
  .from('profiles')
  .update({ nft_mint_address: 'NFT_MINT_ADDRESS_HERE' })
  .eq('wallet_address', walletAddress);
```

## ‚úÖ Everything is Now Compatible!

Refresh your browser and click "MINT YOUR AI SOUL" - it should work perfectly now! üéâ
